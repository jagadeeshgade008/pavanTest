<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- add jquery and bootstrap latest cdns -->
    <!-- import jquery -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>




</head>

<body>

    <!-- create a input field with id search and a button with id submit -->
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Search</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <!-- <form action="search.php" method="post"> -->
                                <div class="form-group">
                                    <label for="search">Search</label>
                                    <input type="text" class="form-control" id="search" name="search">
                                </div>

                                <!-- </form> -->
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <button id="submit" class="btn btn-primary">Submit</button>
                            </div>
                            <div class="col-md-6 d-flex justify-content-end">
                                <!-- add insert & delete buttons -->
                                <button id="insert" class="btn btn-primary">Insert</button>
                                <button id="delete" class="btn btn-primary ml-3 d-none">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- create a div with  -->
    <div class="container mt-3 d-none" id="resultsContainer">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Results</h3>
                    </div>
                    <div class="card-body">
                        <div class="row" id="updateDetailsContainer">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



</body>

<script type="text/javascript">
    $(document).ready(function () {
        $("#submit").click(function () {
            var search = $("#search").val();

            if (search != "") {
                $("#resultsContainer h3").text("Results");

                // hide insert
                $("#insert").addClass("d-none");
                $("#delete").removeClass("d-none");

                /*
                $.ajax({
                url: "/apitocall",
                method: "POST",
                data: {
                    search: search
                },
                success: function (data) {

                    // prepare the object as inputs of the form with type as text

                    var inputs = "";
                    for (var key in data.data) {

                        // each input is a div with class form-group and contains a label and input field with name as key and value as data[key] and with column of 6
                        inputs += "<div class='form-group col-md-6'>" +
                            "<label for='" + key + "'>" + key + "</label>" +
                            "<input type='text' class='form-control' name='" +
                            key + "' value='" + data.data[key] + "'>" +
                            "</div>";

                        // inputs += "<input type='text' class='form-control' name='" + key + "' value='" + data.data[
                        //     key] + "'>";
                    }

                    // add update button
                    inputs +=
                        "<button type='submit' class='btn btn-primary' id='update' name='update'>Update</button>";

                    // append the inputs to the form
                    $("#updateDetailsContainer").append(inputs);

                    $("#update").click(function () {
                        var data = {};
                        $("#resultsContainer input").each(function () {
                            data[$(this).attr("name")] = $(this).val();
                        });
                        console.log(data);

                        // post data to api
                        $.ajax({
                            url: "/apitocall",
                            method: "POST",
                            data: data,
                            success: function (data) {
                                console.log(data);
                            }
                        });

                    });

                }
            });
        
            
            */


                $("#resultsContainer").removeClass("d-none");

                data = {}
                data.status = "success"
                data.message = "message"
                data.data = {
                    "id": "id",
                    "name": "name",
                    "email": "email",
                    "phone": "phone",
                    "address": "address",
                    "city": "city",
                    "state": "state",
                    "zip": "zip",
                    "country": "country",
                    "company": "company",
                    "position": "position",
                    "website": "website",
                    "linkedin": "linkedin",
                    "facebook": "facebook",
                    "twitter": "twitter",
                    "instagram": "instagram",
                    "youtube": "youtube",
                    "notes": "notes"
                }


                // prepare the object as inputs of the form with type as text

                var inputs = "";

                inputs += `<div class="col-12">`;
                // add edit button
                inputs += `
                <div class="row justify-content-end">
                    <button type='submit' class='btn btn-primary' id='edit' name='edit'>Edit</button>
                </div>
            `

                inputs += "<div class='row'>";

                for (var key in data.data) {

                    // each input is a div with class form-group and contains a label and input field with name as key and value as data[key] and with column of 6 and make input disabled
                    inputs += "<div class='form-group col-md-6'>" +
                        "<label for='" + key + "'>" + key + "</label>" +
                        "<input type='text' class='form-control' name='" +
                        key + "' value='" + data.data[key] + "' disabled>" +
                        "</div>";

                    // inputs += "<input type='text' class='form-control' name='" + key + "' value='" + data.data[
                    //     key] + "'>";
                }

                inputs += "</div>";
                inputs += "</div>";

                // add update button
                inputs +=
                    "<button type='submit' class='btn btn-primary d-none' id='update' name='update'>Update</button>";

                // append the inputs to the form
                $("#updateDetailsContainer").html(inputs);


            }else{
                alert("Please enter a search term");
            }

        });


        // add delete button  
        $("#delete").click(function () {

            $("#insert").removeClass("d-none");
            $("#delete").addClass("d-none");

            var data = {};
            $("#resultsContainer input").each(function () {
                data[$(this).attr("name")] = $(this).val();
            });
            console.log(data);

            // show alert notification in updateDetailsContainer container
            $("#updateDetailsContainer").removeClass("d-none");
            $("#updateDetailsContainer").html(`
            <div class="col-md-4">
                <div class="alert alert-danger" role="alert">
                    <b>
                        Document deleted successfully!!!
                    </b>
                </div>
            </div>

            `);

            // post data to api
            // $.ajax({
            //     url: "/apitocall",
            //     method: "POST",
            //     data: data,
            //     success: function (data) {
            //         console.log(data);
            //     }
            // });
        });


        // add insert button
        $('#insert').click(function () {
            // $("#insert").addClass("d-none");
            // $("#delete").removeClass("d-none");

            $("#resultsContainer").removeClass("d-none");
            $("#resultsContainer h3").text("Insert new document");

            data = {
                "id": "",
                "name": "",
                "email": "",
                "phone": "",
                "address": "",
                "city": "",
                "state": "",
                "zip": "",
                "country": "",
                "company": "",
                "position": "",
                "website": "",
                "linkedin": "",
                "facebook": "",
                "twitter": "",
                "instagram": "",
                "youtube": "",
                "notes": ""
            }


            // prepare the object as inputs of the form with type as text

            var inputs = "";
            for (var key in data) {

                // each input is a div with class form-group and contains a label and input field with name as key and value as data[key] and with column of 6
                inputs += "<div class='form-group col-md-6'>" +
                    "<label for='" + key + "'>" + key + "</label>" +
                    "<input type='text' class='form-control' name='" +
                    key + "' value='" + data[key] + "'>" +
                    "</div>";

                // inputs += "<input type='text' class='form-control' name='" + key + "' value='" + data.data[
                //     key] + "'>";
            }

            // add update button
            inputs +=
                "<button type='submit' class='btn btn-primary' id='insertNewDocument' name='insert'>Insert</button>";

            // append the inputs to the form
            $("#updateDetailsContainer").html(inputs);


        });


    });

    $(document).on('click', "#insertNewDocument", function (e) {

        // preapre the data to be sent to api
        var data = {};
        $("#resultsContainer input").each(function () {
            data[$(this).attr("name")] = $(this).val();
        });
        console.log(data);

        alert("Document inserted successfully");
        window.location.reload();

        // post data to api
        $.ajax({
            url: "/apitocall",
            method: "POST",
            data: data,
            success: function (data) {
                console.log(data);
            }
        });

    })

    $(document).on("click", "#edit", function (e) {
        // $("#insert").addClass("d-none");
        // $("#delete").removeClass("d-none");

        // enable all the inputs
        $("#resultsContainer input").each(function () {
            $(this).removeAttr("disabled");
        });

        // show update button
        $("#update").removeClass("d-none");

    });

    $(document).on("click", "#update", function (e) {
        var data = {};
        $("#resultsContainer input").each(function () {
            data[$(this).attr("name")] = $(this).val();
        });
        console.log(data);

        alert("Document updated successfully");

        // post data to api
        $.ajax({
            url: "/apitocall",
            method: "POST",
            data: data,
            success: function (data) {
                console.log(data);
            }
        });

    });

    // For testing purposes uncomment the following lines
</script>


</html>